/*
Holaaa ðŸ˜‚ si estÃ¡s aquÃ­ es para robar la librerÃ­a por lo menos deja los crÃ©ditos de tu papÃ¡ OFC-YOVANI,
ya que andas de rata 
no tengo problemas que usen mi librerÃ­a siempre cuando dejen crÃ©ditos
*/
import{dirname}from'path';import{fileURLToPath}from'url';import*as _0x27b329 from'fs';import*as _0x2f7bfb from'path';import*as _0x2070a3 from'crypto';import{ffmpeg}from'./converter.js';import _0x46e73e from'fluent-ffmpeg';import{spawn}from'child_process';import _0x508042 from'./uploadFile.js';import _0x1e97a7 from'./uploadImage.js';import{fileTypeFromBuffer}from'file-type';import _0x65cf26 from'node-webpmux';import _0x12e6da from'node-fetch';const __dirname=dirname(fileURLToPath(import.meta['url'])),tmp=_0x2f7bfb['join'](__dirname,'../tmp');function sticker2(_0x1817da,_0x55084b){return new Promise(async(_0x5489f0,_0x5bc600)=>{try{if(_0x55084b){const _0x5992f3=await _0x12e6da(_0x55084b);if(_0x5992f3['status']!==0xc8)throw await _0x5992f3['text']();_0x1817da=await _0x5992f3['buffer']();}const _0x92eb75=_0x2f7bfb['join'](tmp,+new Date()+'.jpeg');await _0x27b329['promises']['writeFile'](_0x92eb75,_0x1817da);const _0x4b4d40=spawn('ffmpeg',['-y','-i',_0x92eb75,'-vf','scale=512:512:flags=lanczos:force_original_aspect_ratio=decrease,format=rgba,pad=512:512:(ow-iw)/2:(oh-ih)/2:color=#00000000,setsar=1','-f','png','-']);_0x4b4d40['on']('error',_0x5bc600),_0x4b4d40['on']('close',async()=>{await _0x27b329['promises']['unlink'](_0x92eb75);});const _0x230e8f=[],[_0xb2576f,..._0x5b0167]=[...module['exports']['support']['gm']?['gm']:module['exports']['magick']?['magick']:[],'convert','png:-','webp:-'],_0x2d3085=spawn(_0xb2576f,_0x5b0167);_0x2d3085['on']('error',_0x49c104=>conn['reply'](m['chat'],util['format'](_0x49c104),m)),_0x2d3085['stdout']['on']('data',_0x4bf56f=>_0x230e8f['push'](_0x4bf56f)),_0x4b4d40['stdout']['pipe'](_0x2d3085['stdin']),_0x2d3085['on']('exit',()=>{_0x5489f0(Buffer['concat'](_0x230e8f));});}catch(_0x170d3f){_0x5bc600(_0x170d3f);}});}async function sticker3(_0x385e90,_0x1ff153,_0x10c6ef,_0x333a5b){_0x1ff153=_0x1ff153?_0x1ff153:await _0x508042(_0x385e90);const _0x4afcdd=await _0x12e6da('https://api.xteam.xyz/sticker/wm?'+new URLSearchParams(Object['entries']({'url':_0x1ff153,'packname':_0x10c6ef,'author':_0x333a5b})));return await _0x4afcdd['buffer']();}async function sticker4(_0x93ba8d,_0x328e70){if(_0x328e70){const _0x1d713f=await _0x12e6da(_0x328e70);if(_0x1d713f['status']!==0xc8)throw await _0x1d713f['text']();_0x93ba8d=await _0x1d713f['buffer']();}return await ffmpeg(_0x93ba8d,['-vf','scale=512:512:flags=lanczos:force_original_aspect_ratio=decrease,format=rgba,pad=512:512:(ow-iw)/2:(oh-ih)/2:color=#00000000,setsar=1'],'jpeg','webp');}async function sticker5(_0x402d1e,_0x28fe4f,_0x1a0acb,_0x5448fe,_0x5821bf=[''],_0x2bef42={}){const {Sticker:_0x2ef913}=await import('wa-sticker-formatter'),_0x1798a5={'type':'default','pack':_0x1a0acb,'author':_0x5448fe,'categories':_0x5821bf,..._0x2bef42};return new _0x2ef913(_0x402d1e?_0x402d1e:_0x28fe4f,_0x1798a5)['toBuffer']();}function sticker6(_0x429469,_0xe92eb1){return new Promise(async(_0x3a1018,_0x4086b7)=>{if(_0xe92eb1){const _0x28437d=await _0x12e6da(_0xe92eb1);if(_0x28437d['status']!==0xc8)throw await _0x28437d['text']();_0x429469=await _0x28437d['buffer']();}const _0x565d7a=await fileTypeFromBuffer(_0x429469)||{'mime':'application/octet-stream','ext':'bin'};if(_0x565d7a['ext']=='bin')_0x4086b7(_0x429469);const _0x1019df=_0x2f7bfb['join'](__dirname,'../tmp/'+ +new Date()+'.'+_0x565d7a['ext']),_0x4fe2bf=_0x2f7bfb['join'](_0x1019df+'.webp');await _0x27b329['promises']['writeFile'](_0x1019df,_0x429469);const _0x33c0a0=/video/i['test'](_0x565d7a['mime'])?_0x46e73e(_0x1019df)['inputFormat'](_0x565d7a['ext']):_0x46e73e(_0x1019df)['input'](_0x1019df);_0x33c0a0['on']('error',function(_0x2cde95){console['error'](_0x2cde95),_0x27b329['promises']['unlink'](_0x1019df),_0x4086b7(_0x429469);})['on']('end',async function(){_0x27b329['promises']['unlink'](_0x1019df),_0x3a1018(await _0x27b329['promises']['readFile'](_0x4fe2bf));})['addOutputOptions'](['-vcodec','libwebp','-vf','scale=\x27min(320,iw)\x27:min\x27(320,ih)\x27:force_original_aspect_ratio=decrease,fps=15,\x20pad=320:320:-1:-1:color=white@0.0,\x20split\x20[a][b];\x20[a]\x20palettegen=reserve_transparent=on:transparency_color=ffffff\x20[p];\x20[b][p]\x20paletteuse'])['toFormat']('webp')['save'](_0x4fe2bf);});}async function addExif(_0x51e90a,_0x1fdef4,_0x54bab0,_0x16d594=[''],_0x583fe2={}){const _0x500ca9=new _0x65cf26['Image'](),_0x1d05a8=_0x2070a3['randomBytes'](0x20)['toString']('hex'),_0x4c84ba={'sticker-pack-id':_0x1d05a8,'sticker-pack-name':_0x1fdef4,'sticker-pack-publisher':_0x54bab0,'emojis':_0x16d594,..._0x583fe2},_0x5b90e7=Buffer['from']([0x49,0x49,0x2a,0x0,0x8,0x0,0x0,0x0,0x1,0x0,0x41,0x57,0x7,0x0,0x0,0x0,0x0,0x0,0x16,0x0,0x0,0x0]),_0x4347dd=Buffer['from'](JSON['stringify'](_0x4c84ba),'utf8'),_0x41cefa=Buffer['concat']([_0x5b90e7,_0x4347dd]);return _0x41cefa['writeUIntLE'](_0x4347dd['length'],0xe,0x4),await _0x500ca9['load'](_0x51e90a),_0x500ca9['exif']=_0x41cefa,await _0x500ca9['save'](null);}async function sticker(_0x1703f9,_0x5199e9,..._0x3d02ca){let _0x2704d0,_0x22f6c9;for(const _0x3551f4 of[sticker3,global['support']['ffmpeg']&&sticker6,sticker5,global['support']['ffmpeg']&&global['support']['ffmpegWebp']&&sticker4,global['support']['ffmpeg']&&(global['support']['convert']||global['support']['magick']||global['support']['gm'])&&sticker2]['filter'](_0x264af3=>_0x264af3)){try{_0x22f6c9=await _0x3551f4(_0x1703f9,_0x5199e9,..._0x3d02ca);if(_0x22f6c9['includes']('html'))continue;if(_0x22f6c9['includes']('WEBP'))try{return await addExif(_0x22f6c9,..._0x3d02ca);}catch(_0x2e5ee8){return console['error'](_0x2e5ee8),_0x22f6c9;}throw _0x22f6c9['toString']();}catch(_0x33549d){_0x2704d0=_0x33549d;continue;}}return console['error'](_0x2704d0),_0x2704d0;}const support={'ffmpeg':!![],'ffprobe':!![],'ffmpegWebp':!![],'convert':!![],'magick':![],'gm':![],'find':![]};export{sticker,sticker2,sticker3,sticker4,sticker6,addExif,support};